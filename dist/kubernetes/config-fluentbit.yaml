apiVersion: v1
kind: ConfigMap
metadata:
  name: config-fluentbit
data:
  fluent-bit.conf: |
    [INPUT]
        Name tail
        Tag nginx_access
        DB /var/log/nginx/access.fluentbit.db
        Read_from_Head On
        Path /var/log/nginx/access.log

    [INPUT]
        Name tail
        Tag nginx_error
        DB /var/log/nginx/error.fluentbit.db
        Read_from_Head On
        Path /var/log/nginx/error.log

    [OUTPUT]
        Name s3
        Match *
        endpoint sfo2.digitaloceanspaces.com
        bucket kanjimi-storage
        store_dir /var/log/nginx/fluentbit_tmp_s3
        s3_key_format /logs/$TAG/%Y-%m/%Y-%m-%d_%H-%M-%S.log

