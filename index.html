<style type="text/css">
    p {
        clear: both;
        margin-bottom: 30px;
        display: block;
    }
    p > span {
        float: left;
        margin-bottom: 15px;
        height: 2rem;
        text-align: center;
    }

    p > span:nth-child(odd) {
        background: #DDDDDD;
    }

    p > span .furigana, p > span .meaning {
        font-size: 0.5rem;
        display: block;
    }
</style>
<script>
    window.addEventListener('load', function () {
        var ps = document.getElementsByTagName('p');
        for (var i = 0; i < ps.length; i++) {
            var p = ps[i]
            var tokens = await tokenizer.tokenize(p.innerText)
            console.log(tokens)
            p.innerText = ''
            tokens.map(function (token) {
                var span = document.createElement('span')

                var furigana = wanakana.isKana(token.surface_form) || isCharJapanesePunctuation(token.surface_form)
                    ? ' '
                    : wanakana.toHiragana(token.pronunciation || token.reading)

                var entry = dict[token.surface_form] || dict[token.reading]
                var meaning = entry && entry.length == 3 && !(
                    particles.includes(token.surface_form)
                    || particles.includes(token.reading)
                ) && !wanakana.isHiragana(token.surface_form)
                    ? entry[2].replace(/^\(.*\) ([^/]+).*$/, '$1')
                    : ' '

                span.innerHTML =
                    '<span class="furigana">' + furigana + '</span>'
                    + token.surface_form
                    + '<span class="meaning">' + meaning + '</span>'

                p.appendChild(span)
            })
        }
    })
</script>
